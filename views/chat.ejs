<%- layout('layout') %>

    <% if (receiver){ %>
        <h1 class="text-center w-full p-5 bg-periwinkle">
            <%= receiver.fname +" "+ receiver.lname %></h1>


        <div class="chat w-[60vw] p-5 h-[80vh] m-auto overflow-y-scroll" id="chat">


            <!-- YE LEFT ME -->
            <div class="message-container space-y-5"> <!-- This container adds vertical space between messages -->
                <% messages.forEach(message => { %>
                  <% if (message.to == user.id) { %>
                    
                    <!-- RECEIVED MESSAGE (aligned to the left) -->
                    <div class="flex justify-start"> <!-- Flex container aligns to start for received messages -->
                      <div class="message-rec w-fit bg-accent-light p-2 rounded-r-lg rounded-b-lg relative max-w-[50vw]">
                        <p class="timestamp opacity-50 absolute left-0 -top-6">
                          <%= message.timestamp.toLocaleTimeString('en-GB', { hour: '2-digit' , minute: '2-digit' }) %>
                        </p>
                        <p class="mtext">
                          <%= message.content %>
                        </p>
                      </div>
                    </div>
              
                  <% } else { %>
              
                    <!-- SENT MESSAGE (aligned to the right) -->
                    <div class="flex justify-end"> <!-- Flex container aligns to end for sent messages -->
                      <div class="message-sent w-fit bg-accent-light p-2 rounded-l-lg rounded-b-lg relative max-w-[50vw]">
                        <p class="timestamp opacity-50 absolute right-0 -top-6">
                          <%= message.timestamp.toLocaleTimeString('en-GB', { hour: '2-digit' , minute: '2-digit' }) %>
                        </p>
                        <p class="mtext">
                          <%= message.content %>
                        </p>
                      </div>
                    </div>
              
                  <% } %>
                <% }) %>
              </div>
              
                </div>

                <div id="input-field" class="pt-5 flex flex-col w-[80vw] m-auto">
                    <form action="/chat/<%= receiver.id %>" method="post" class="flex flex-row justify-center">

                        <input type="hidden" name="from" value="<%= user.id %>">
                        <input type="hidden" name="to" value="<%= receiver.id %>">
                        <input class="p-3 w-[50vw] bg-transparent border-2 border-accent-dark outline-none text-primary" type="text" placeholder="Type your message here.." name="content">
                        <button type="submit" class="p-2 bg-accent-dark"><img src="/send.svg" class="w-6" alt=""></button>
                    </form>
                </div>

                <% } %>





<% block('js', `
<script>
    
  function scrollToBottom() {
    const chat = document.getElementById('chat');
    chat.scrollTop = chat.scrollHeight;
  }

  window.onload = scrollToBottom;
    
    </script>
    `) %>